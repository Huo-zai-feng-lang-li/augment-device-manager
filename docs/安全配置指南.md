# 🔒 安全配置指南

## 概述

本项目已经移除了所有硬编码的敏感信息，现在需要通过环境变量来配置令牌和密钥。

## 🚨 重要安全提醒

**绝对不要将敏感信息提交到版本控制系统！**

- ❌ 不要在代码中硬编码 API 密钥、令牌或密码
- ❌ 不要提交包含敏感信息的配置文件
- ✅ 使用环境变量存储敏感信息
- ✅ 使用 `.gitignore` 忽略敏感文件

## 📋 需要配置的环境变量

### 1. GitHub Personal Access Token

用于自动更新 GitHub 配置文件。

**获取方式：**
1. 访问 GitHub Settings → Developer settings → Personal access tokens
2. 生成新的 token，权限选择：`repo` (完整仓库访问权限)
3. 复制生成的 token

**配置方式：**

Windows (命令提示符):
```cmd
set GITHUB_TOKEN=your_github_token_here
```

Windows (PowerShell):
```powershell
$env:GITHUB_TOKEN="your_github_token_here"
```

Linux/macOS:
```bash
export GITHUB_TOKEN=your_github_token_here
```

### 2. ngrok 认证令牌

用于建立安全的隧道连接。

**获取方式：**
1. 访问 https://ngrok.com/ 注册账号
2. 在 Dashboard 中获取 Authtoken

**配置方式：**
1. 复制 `ngrok.yml.example` 为 `ngrok.yml`
2. 将 `YOUR_NGROK_AUTHTOKEN_HERE` 替换为您的实际令牌

或者使用命令行：
```bash
tools\ngrok.exe config add-authtoken YOUR_NGROK_TOKEN
```

## 🔧 验证配置

### 检查 GitHub Token
```bash
# Windows
echo %GITHUB_TOKEN%

# Linux/macOS  
echo $GITHUB_TOKEN

# 测试 API 访问
curl -H "Authorization: token %GITHUB_TOKEN%" https://api.github.com/user
```

### 检查 ngrok 配置
```bash
# 检查配置
tools\ngrok.exe config check

# 测试连接
tools\ngrok.exe http 3002
```

## 📁 被忽略的敏感文件

以下文件类型已被添加到 `.gitignore` 中：

```
# Token files (安全：绝不提交token)
*token*
*secret*
*key*
.env*
auth.json
credentials.json
ngrok.yml
```

## 🚀 启动项目

配置完环境变量后：

```bash
# 1. 启动服务
npm run server:start

# 2. 或者分步启动
npm run server-only  # 启动后端
tools\ngrok.exe http 3002  # 启动 ngrok
```

## ❗ 故障排除

### 问题：推送被拒绝，提示包含敏感信息
**解决方案：** 本项目已经清理了所有历史中的敏感信息。如果仍有问题，请检查：
1. 是否有新的敏感信息被意外添加
2. 本地是否有未提交的敏感文件

### 问题：环境变量未生效
**解决方案：**
1. 重启终端/命令提示符
2. 检查环境变量是否正确设置
3. 使用 `echo` 命令验证变量值

### 问题：ngrok 连接失败
**解决方案：**
1. 确认认证令牌正确配置
2. 检查网络连接
3. 查看 ngrok 日志输出

## 📞 获取帮助

如果遇到配置问题，请：
1. 检查本文档的故障排除部分
2. 查看项目的其他文档
3. 确保所有敏感信息都通过环境变量配置
