# 3种模式清理说明

本文档详细说明Augment设备管理器的三种清理模式的具体清理内容、保护机制和预期效果。

## 📋 模式对比总览

| 特性 | 🧠 智能清理 | 🔧 标准清理 | 💥 完全清理 |
|------|------------|------------|------------|
| **清理深度** | 最小化 | 深度清理 | 彻底重置 |
| **配置保护** | 全面保护 | 保护核心 | 仅保护MCP |
| **登录状态** | 保留 | 保留 | 清除 |
| **注册表** | 不清理 | 清理 | 完全清理 |
| **适用场景** | 日常使用 | 深度重置 | 完全重新开始 |

---

## 🧠 智能清理模式（Intelligent Mode）

### 设计理念
精准清理设备身份数据，让Augment扩展认为是新用户，同时最大程度保留用户的所有配置和设置。

### 清理内容

#### 设备身份数据
- `storage.json` 中的关键字段：
  - `devDeviceId` - 设备唯一标识
  - `telemetry.machineId` - 遥测机器ID
  - `telemetry.sessionId` - 会话ID
- 设备指纹缓存文件
- Augment扩展的用户身份文件：
  - `user-*` - 用户相关文件
  - `session-*` - 会话相关文件
  - `auth-*` - 认证相关文件
  - `device-*` - 设备相关文件
  - `fingerprint*` - 指纹相关文件

#### 数据库清理
- `state.vscdb` 中的Augment会话记录
- 保留Cursor登录状态和其他应用数据

### 保护内容
- ✅ MCP配置文件（支持Cursor和VS Code双IDE）
- ✅ IDE核心设置和用户配置
- ✅ 工作区配置和项目设置
- ✅ Cursor登录状态
- ✅ 所有扩展设置和用户偏好

### 预期效果
- Augment扩展需要重新登录
- 生成全新的设备ID
- 保持所有IDE配置不变
- 不影响其他扩展和应用
- **不清理注册表**
- **不重置IDE到全新状态**

### 适用场景
- 日常设备身份重置
- 需要保留所有配置的情况
- 轻量级清理需求

---

## 🔧 标准清理模式（Standard Mode）

### 设计理念
深度清理大部分数据，保留核心配置和登录状态，适合需要较彻底清理但不想重新配置的场景。

### 清理内容

#### 深度数据清理
- 所有Augment存储数据
- SQLite状态数据库（先备份后清理）
- 设备指纹和唯一标识
- 浏览器相关数据和缓存
- 系统临时文件

#### 注册表清理（Windows）
- `HKEY_CURRENT_USER\Software\Augment`
- `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\Augment`

#### 扩展数据清理
- Cursor扩展数据和工作区存储
- 扩展缓存和日志文件
- 保留Cursor IDE登录状态

### 保护内容
- ✅ MCP配置文件
- ✅ Cursor登录状态
- ✅ 核心IDE配置

### 清理特性
- **多轮清理**：确保彻底性
- **实时监控**：防止数据恢复
- **PowerShell辅助**：增强清理效果
- **激进模式**：深度清理验证

### 预期效果
- 深度清理大部分IDE数据
- 重置设备指纹和身份标识
- 清理注册表相关项
- 保留Cursor IDE登录状态
- 需要重新配置部分扩展

### 适用场景
- 需要深度重置但保留登录
- 解决扩展冲突问题
- 清理累积的缓存和临时数据

---

## 💥 完全清理模式（Complete Mode）

### 设计理念
彻底重置到全新安装状态，仅保护MCP配置文件，适合需要完全重新开始的场景。

### 清理内容

#### 彻底重置
- 删除几乎所有IDE数据
- 完全重置Cursor和VS Code
- 清理所有用户数据和设置
- 重置所有身份标识
- 清理所有缓存和临时文件

#### 系统级清理
- 注册表完全清理
- 所有设备指纹数据
- 所有Augment相关数据
- **不保留Cursor登录状态**
- 清理所有扩展数据

### 保护内容
- ✅ **仅保护MCP配置文件**

### 清理特性
- **最高清理级别**
- **跳过备份创建**：防止IDE恢复
- **强制进程终止**
- **完全重置模式**

### 预期效果
- 回到全新安装状态
- 最高级别的清理深度
- 需要重新配置所有IDE设置
- 需要重新登录所有账户
- 需要重新安装和配置扩展

### 适用场景
- IDE出现严重问题需要完全重置
- 需要彻底清除所有痕迹
- 准备转移设备或重新分配

---

## 🔧 技术实现细节

### 设备ID处理机制
所有三种模式都会：
1. **重新生成设备标识**：
   - 更新 `devDeviceId`
   - 重置 `telemetry.machineId`
   - 刷新 `telemetry.sessionId`

2. **清理指纹缓存**：
   - 删除本地指纹文件
   - 清理缓存的设备信息

### 数据库清理策略
- **智能模式**：选择性清理Augment会话数据
- **标准模式**：备份后清理SQLite数据库
- **完全模式**：彻底删除所有数据库内容

### MCP配置保护机制
所有模式都使用通用保护机制：
1. **备份MCP配置**：
   - Cursor: `C:\Users\Administrator\AppData\Roaming\Cursor\User\globalStorage\augment.vscode-augment\augment-global-state\mcpServers.json`
   - VS Code: `C:\Users\Administrator\AppData\Roaming\Code\User\globalStorage\augment.vscode-augment\augment-global-state\mcpServers.json`

2. **清理执行**
3. **恢复MCP配置**

### 注册表清理范围
- **智能模式**：不涉及注册表
- **标准/完全模式**：清理Augment相关注册表项

---

## 🎯 选择建议

### 推荐使用场景

| 需求 | 推荐模式 | 理由 |
|------|----------|------|
| 日常设备身份重置 | 🧠 智能清理 | 保留所有配置，影响最小 |
| 解决扩展问题 | 🔧 标准清理 | 深度清理但保留核心功能 |
| IDE严重故障 | 💥 完全清理 | 彻底重置解决根本问题 |
| 设备转移 | 💥 完全清理 | 清除所有个人数据 |
| 保留工作环境 | 🧠 智能清理 | 最大程度保护工作配置 |

### 注意事项
1. **备份重要数据**：清理前建议备份重要的项目和配置
2. **网络环境**：清理后可能需要重新配置网络代理等设置
3. **扩展重装**：完全清理模式需要重新安装所有扩展
4. **MCP配置**：所有模式都会保护MCP配置，无需担心丢失

---

## 📞 技术支持

如果在使用过程中遇到问题：
1. 查看清理日志了解具体执行情况
2. 检查MCP配置是否正确恢复
3. 确认设备ID是否成功更新
4. 验证目标效果是否达成

更多技术细节请参考主文档和源代码实现。
