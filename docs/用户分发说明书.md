# 📖 Augment设备管理器 - 用户分发说明书

## 🎯 概述

本说明书详细介绍如何使用GitHub自动配置方案，实现**一次分发，永久有效**的远程客户端分发。

## 🚀 快速开始

### 📋 前置条件

- ✅ ngrok账号和Token已配置
- ✅ GitHub Token已设置
- ✅ 项目依赖已安装

### ⚡ 三步分发

```bash
# 1. 启动服务
npm run server:start

# 2. 构建客户端
npm run build:github

# 3. 分发exe给用户
```

## 📋 详细分发流程

### 🎯 **第一次分发（完整流程）**

#### **步骤1：启动服务**

```bash
npm run server:start
```

**执行内容**：
- 🚀 启动后端服务 (端口3002)
- 🔗 启动ngrok隧道
- 📤 自动更新GitHub配置
- 👁️ 开始地址监控 (每30秒检查)

**预期输出**：
```
🚀 自动更新配置的服务器启动脚本
✅ 检测到ngrok地址: abc123.ngrok-free.app
📤 自动更新GitHub配置...
✅ GitHub配置更新成功
🔍 启动配置监控...
```

#### **步骤2：构建客户端**

```bash
npm run build:github
```

**执行内容**：
- 🔍 检测当前ngrok地址
- ⚙️ 配置客户端为GitHub自动模式
- 📦 构建exe安装包

**预期输出**：
```
🚀 GitHub自动配置打包...
✅ 检测到ngrok地址: abc123.ngrok-free.app
✅ GitHub配置更新成功
✅ 客户端配置完成
📦 构建客户端...
✅ 构建成功
```

**生成文件**：
- 📁 `modules/desktop-client/dist-final/Augment设备管理器 Setup 1.0.0.exe`

#### **步骤3：分发给用户**

**分发文件**：
- 📁 文件位置：`modules/desktop-client/dist-final/Augment设备管理器 Setup 1.0.0.exe`
- 📊 文件大小：约 150-200MB
- 🎯 目标用户：需要激活Cursor Augment的用户

**用户安装流程**：
1. 双击exe文件安装
2. 安装完成后自动启动
3. 客户端自动从GitHub获取服务器地址
4. 自动连接到您的服务

### 🔄 **后续重启流程（核心优势）**

#### **场景：您需要重启服务**

**原因可能包括**：
- 电脑重启
- 网络变化
- 服务维护
- ngrok地址过期

#### **重启步骤**

```bash
# 停止当前服务（如果在运行）
# 方法1: 在终端按 Ctrl+C
# 方法2: 直接关闭终端窗口
# 方法3: 运行停止命令
npm run server:stop

# 重新启动服务
npm run server:start
```

#### **自动化过程**

1. **获取新地址**：ngrok分配新的随机地址
2. **自动更新GitHub**：系统自动将新地址推送到GitHub
3. **用户自动适配**：用户客户端自动获取新地址
4. **无缝重连**：用户无需任何操作即可继续使用

## 🎉 核心优势

### 🚀 **一次分发，永久有效**

**传统方案问题**：
- ❌ ngrok地址变化需要重新打包
- ❌ 需要重新分发给所有用户
- ❌ 用户需要重新下载安装

**我们的解决方案**：
- ✅ 用户只需安装一次
- ✅ 地址变化时自动适配
- ✅ 无需重新分发

### 🔄 **自动地址同步**

**工作机制**：
- 🔍 每30秒检查ngrok地址变化
- 📤 地址变化时自动更新GitHub配置
- 📥 客户端连接失败时自动获取新配置
- 🔄 自动重连到新地址

### 👥 **用户零配置**

**用户体验**：
- 📦 安装exe后自动工作
- 🔗 自动连接到服务器
- 🔄 服务器地址变化时自动适配
- 🛡️ 网络问题时自动降级

### 🛡️ **多重降级保障**

**网络降级机制**：
1. **GitHub直接访问** (最佳)
2. **GitHub CDN** (备用)
3. **本地缓存** (离线)
4. **预设地址** (兜底)

## 🧪 验证和测试

### 📊 **测试命令**

```bash
# 测试完整工作流程
npm run test:workflow

# 检查环境配置
npm run check:env

# 测试GitHub连接
npm run test:github
```

### 🔍 **验证清单**

#### **服务端验证**
- [ ] ngrok服务正常运行
- [ ] 后端服务可访问
- [ ] GitHub配置已更新
- [ ] 地址监控正常工作

#### **客户端验证**
- [ ] exe文件正常生成
- [ ] 安装包可以正常安装
- [ ] 客户端可以获取GitHub配置
- [ ] 客户端可以连接到服务器

#### **流程验证**
- [ ] 重启服务后地址自动更新
- [ ] 用户客户端自动重连
- [ ] 网络异常时降级方案生效

## 🔧 故障排除

### ❓ **常见问题**

#### **Q1: 构建失败，提示文件被占用**
```bash
# 解决方案：关闭正在运行的客户端
taskkill /f /im "Augment设备管理器.exe" 2>nul
# 然后重新构建
npm run build:github
```

#### **Q2: GitHub配置更新失败**
```bash
# 检查GitHub Token
npm run test:github
# 检查网络连接
npm run check:env
```

#### **Q3: 用户无法连接**
```bash
# 检查服务状态
npm run test:workflow
# 确认GitHub配置
curl https://raw.githubusercontent.com/Huo-zai-feng-lang-li/augment-device-manager/main/server-config.json
```

### 🛠️ **调试工具**

```bash
# 显示详细环境信息
npm run check:env

# 测试GitHub连接
npm run test:github

# 完整工作流程测试
npm run test:workflow
```

## 📋 最佳实践

### 🎯 **分发建议**

1. **首次分发前**：
   - 运行完整测试确保一切正常
   - 记录当前ngrok地址供参考
   - 准备用户使用说明

2. **分发过程中**：
   - 保持服务持续运行
   - 监控GitHub配置更新状态
   - 准备技术支持

3. **分发完成后**：
   - 定期检查服务状态
   - 监控用户反馈
   - 及时处理问题

### 🔄 **维护建议**

1. **定期检查**：
   - 每天检查服务运行状态
   - 每周验证GitHub配置同步
   - 每月更新依赖和安全补丁

2. **备份策略**：
   - 定期备份配置文件
   - 保存重要的ngrok地址记录
   - 备份用户反馈和问题记录

## 📞 技术支持

### 🆘 **获取帮助**

如果遇到问题，请按以下顺序排查：

1. **查看日志**：检查终端输出的错误信息
2. **运行测试**：使用内置测试命令诊断问题
3. **查看文档**：参考项目文档和说明
4. **联系支持**：提供详细的错误信息和环境描述

### 📋 **问题报告模板**

```
问题描述：[简要描述问题]
复现步骤：[详细的操作步骤]
错误信息：[完整的错误输出]
环境信息：[操作系统、Node.js版本等]
测试结果：[npm run check:env 的输出]
```

---

**🎉 恭喜！您现在拥有了一个完全自动化的客户端分发系统！**

**核心优势总结**：
- 🚀 一次分发，永久有效
- 🔄 自动地址同步
- 👥 用户零配置
- 🛡️ 多重降级保障

**让用户享受无缝的激活体验吧！** ✨
