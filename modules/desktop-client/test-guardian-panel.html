<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-slate-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold text-slate-800 mb-6">ğŸ›¡ï¸ å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—æµ‹è¯•</h1>
        
        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="mb-6 flex gap-4">
            <button onclick="showGuardianStatusPanel()" class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600">
                æ˜¾ç¤ºé˜²æŠ¤çŠ¶æ€æ¿å—
            </button>
            <button onclick="hideGuardianStatusPanel()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">
                éšè—é˜²æŠ¤çŠ¶æ€æ¿å—
            </button>
            <button onclick="testUpdateStatus()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                æµ‹è¯•çŠ¶æ€æ›´æ–°
            </button>
        </div>

        <!-- å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å— -->
        <div id="guardian-status-panel" class="card rounded-2xl p-6 shadow-sm bg-white" style="display: none;">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="font-medium text-slate-800">ğŸ›¡ï¸ å¢å¼ºé˜²æŠ¤çŠ¶æ€</h3>
              <p class="text-sm text-slate-500" id="guardian-panel-mode">é˜²æŠ¤æ¨¡å¼ï¼šæœªå¯åŠ¨</p>
            </div>
            <button onclick="refreshGuardianStatus()" class="text-slate-400 hover:text-slate-600 transition-colors" title="åˆ·æ–°çŠ¶æ€">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
              </svg>
            </button>
          </div>
          
          <!-- æ‹¦æˆªç»Ÿè®¡ -->
          <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="text-center p-4 bg-gradient-to-br from-red-50 to-red-100 rounded-xl border border-red-200">
              <div class="text-2xl font-bold text-red-600 mb-1" id="panel-intercept-count">0</div>
              <div class="text-sm text-red-700 font-medium">æ‹¦æˆªæ¬¡æ•°</div>
              <div class="text-xs text-red-500 mt-1">IDEæ“ä½œæ‹¦æˆª</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl border border-orange-200">
              <div class="text-2xl font-bold text-orange-600 mb-1" id="panel-backup-removed">0</div>
              <div class="text-sm text-orange-700 font-medium">åˆ é™¤å¤‡ä»½</div>
              <div class="text-xs text-orange-500 mt-1">å¤‡ä»½æ–‡ä»¶æ¸…ç†</div>
            </div>
            <div class="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200">
              <div class="text-2xl font-bold text-blue-600 mb-1" id="panel-protection-restored">0</div>
              <div class="text-sm text-blue-700 font-medium">æ¢å¤ä¿æŠ¤</div>
              <div class="text-xs text-blue-500 mt-1">ä¿æŠ¤æœºåˆ¶æ¢å¤</div>
            </div>
          </div>

          <!-- æœ€è¿‘æ‹¦æˆªè®°å½• -->
          <div class="mb-6">
            <div class="flex items-center justify-between mb-3">
              <h4 class="text-sm font-medium text-slate-700">æœ€è¿‘æ‹¦æˆªè®°å½•</h4>
              <span class="text-xs text-slate-500">å®æ—¶æ›´æ–°</span>
            </div>
            <div id="panel-recent-intercepts" class="bg-slate-50 rounded-lg p-3 min-h-[80px] max-h-32 overflow-y-auto">
              <div class="text-center text-slate-400 py-4">
                <svg class="w-8 h-8 mx-auto mb-2 text-slate-300" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                </svg>
                <div class="text-sm text-slate-400">æš‚æ— æ‹¦æˆªè®°å½•</div>
              </div>
            </div>
          </div>

          <!-- æ§åˆ¶æŒ‰é’® -->
          <div class="flex gap-3">
            <button onclick="stopGuardianService()" class="flex-1 px-4 py-2 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 012 0v4a1 1 0 11-2 0V7zM12 7a1 1 0 012 0v4a1 1 0 11-2 0V7z"/>
              </svg>
              åœæ­¢é˜²æŠ¤
            </button>
            <button onclick="viewGuardianLogs()" class="flex-1 px-4 py-2 bg-slate-500 text-white font-medium rounded-lg hover:bg-slate-600 transition-colors flex items-center justify-center gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
              æŸ¥çœ‹æ—¥å¿—
            </button>
          </div>
        </div>
    </div>

    <script>
        // æ˜¾ç¤ºå¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—
        function showGuardianStatusPanel() {
            const panel = document.getElementById('guardian-status-panel');
            if (panel) {
                panel.style.display = 'block';
                console.log('æ˜¾ç¤ºå¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—');
            }
        }

        // éšè—å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—
        function hideGuardianStatusPanel() {
            const panel = document.getElementById('guardian-status-panel');
            if (panel) {
                panel.style.display = 'none';
                console.log('éšè—å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—');
            }
        }

        // åˆ·æ–°å¢å¼ºé˜²æŠ¤çŠ¶æ€
        function refreshGuardianStatus() {
            console.log('åˆ·æ–°å¢å¼ºé˜²æŠ¤çŠ¶æ€');
            // æ¨¡æ‹ŸçŠ¶æ€æ›´æ–°
            testUpdateStatus();
        }

        // æµ‹è¯•çŠ¶æ€æ›´æ–°
        function testUpdateStatus() {
            const mockStatus = {
                isRunning: true,
                stats: {
                    interceptCount: Math.floor(Math.random() * 20) + 1,
                    backupRemoved: Math.floor(Math.random() * 15) + 1,
                    protectionRestored: Math.floor(Math.random() * 10) + 1
                },
                recentIntercepts: [
                    {
                        type: 'ide_operation',
                        description: 'æ‹¦æˆªIDEæ“ä½œ',
                        timestamp: Date.now() - 120000
                    },
                    {
                        type: 'backup_removal',
                        description: 'åˆ é™¤å¤‡ä»½æ–‡ä»¶',
                        timestamp: Date.now() - 60000
                    },
                    {
                        type: 'protection_restore',
                        description: 'æ¢å¤ä¿æŠ¤',
                        timestamp: Date.now() - 30000
                    }
                ]
            };
            
            updateGuardianStatusPanel(mockStatus);
        }

        // æ›´æ–°å¢å¼ºé˜²æŠ¤çŠ¶æ€æ¿å—
        function updateGuardianStatusPanel(status) {
            // æ›´æ–°é˜²æŠ¤æ¨¡å¼æ˜¾ç¤º
            const modeElement = document.getElementById('guardian-panel-mode');
            if (modeElement) {
                if (status.isRunning) {
                    modeElement.textContent = 'é˜²æŠ¤æ¨¡å¼ï¼šç‹¬ç«‹æœåŠ¡ï¼ˆæŒä¹…é˜²æŠ¤ï¼‰';
                    modeElement.className = 'text-sm text-emerald-600 font-medium';
                } else {
                    modeElement.textContent = 'é˜²æŠ¤æ¨¡å¼ï¼šæœªå¯åŠ¨';
                    modeElement.className = 'text-sm text-slate-500';
                }
            }

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            const interceptCount = document.getElementById('panel-intercept-count');
            const backupRemoved = document.getElementById('panel-backup-removed');
            const protectionRestored = document.getElementById('panel-protection-restored');
            
            if (interceptCount) interceptCount.textContent = status.stats?.interceptCount || 0;
            if (backupRemoved) backupRemoved.textContent = status.stats?.backupRemoved || 0;
            if (protectionRestored) protectionRestored.textContent = status.stats?.protectionRestored || 0;

            // æ›´æ–°æœ€è¿‘æ‹¦æˆªè®°å½•
            updateRecentIntercepts(status.recentIntercepts || []);
        }

        // æ›´æ–°æœ€è¿‘æ‹¦æˆªè®°å½•
        function updateRecentIntercepts(intercepts) {
            const container = document.getElementById('panel-recent-intercepts');
            if (!container) return;

            if (intercepts.length === 0) {
                container.innerHTML = `
                  <div class="text-center text-slate-400 py-4">
                    <svg class="w-8 h-8 mx-auto mb-2 text-slate-300" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                    </svg>
                    <div class="text-sm text-slate-400">æš‚æ— æ‹¦æˆªè®°å½•</div>
                  </div>
                `;
                return;
            }

            const interceptsHtml = intercepts.slice(0, 5).map(intercept => {
                const iconMap = {
                    'ide_operation': 'ğŸš¨',
                    'backup_removal': 'ğŸ—‘ï¸',
                    'protection_restore': 'ğŸ”’'
                };
                const icon = iconMap[intercept.type] || 'ğŸ›¡ï¸';
                const time = new Date(intercept.timestamp).toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                return `
                  <div class="flex items-center justify-between py-2 border-b border-slate-200 last:border-b-0">
                    <div class="flex items-center gap-2">
                      <span class="text-sm">${icon}</span>
                      <span class="text-sm text-slate-700">${intercept.description}</span>
                    </div>
                    <span class="text-xs text-slate-500">${time}</span>
                  </div>
                `;
            }).join('');

            container.innerHTML = interceptsHtml;
        }

        // åœæ­¢å¢å¼ºé˜²æŠ¤æœåŠ¡
        function stopGuardianService() {
            if (confirm('ç¡®å®šè¦åœæ­¢å¢å¼ºé˜²æŠ¤æœåŠ¡å—ï¼Ÿ\n\nåœæ­¢åå°†æ— æ³•æ‹¦æˆªIDEçš„è®¾å¤‡IDæ¢å¤æ“ä½œã€‚')) {
                console.log('åœæ­¢å¢å¼ºé˜²æŠ¤æœåŠ¡');
                alert('å¢å¼ºé˜²æŠ¤æœåŠ¡å·²åœæ­¢');
                hideGuardianStatusPanel();
            }
        }

        // æŸ¥çœ‹å¢å¼ºé˜²æŠ¤æ—¥å¿—
        function viewGuardianLogs() {
            console.log('æŸ¥çœ‹å¢å¼ºé˜²æŠ¤æ—¥å¿—');
            alert('æ‰“å¼€å¢å¼ºé˜²æŠ¤æ—¥å¿—');
        }
    </script>
</body>
</html>
